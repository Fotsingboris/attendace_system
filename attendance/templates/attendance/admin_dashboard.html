{% extends 'attendance/base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h3 class="text-center">Admin Dashboard</h3>

<div class="container">
    <h5>Employee and Attendance Stats</h5>

    <!-- Filters Section -->
    <form method="get" class="mb-4">
        <div class="row">
            <div class="col-md-3">
                <label for="dateFilter">Filter by Date</label>
                <input type="date" name="date" id="dateFilter" class="form-control" value="{{ filter_date }}">
            </div>
            <div class="col-md-3">
                <label for="userFilter">Filter by User</label>
                <select name="user" id="userFilter" class="form-control">
                    <option value="">All Users</option>
                    {% for user in users %}
                        <option value="{{ user.id }}" {% if user.id == filter_user %}selected{% endif %}>{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary mt-4">Apply Filters</button>
            </div>
        </div>
    </form>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Total Employees</h5>
                    <p class="card-text">{{ total_employees }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Total Attendance Records</h5>
                    <p class="card-text">{{ total_attendance }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Today's Attendance</h5>
                    <p class="card-text">{{ today_attendance }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Employees Without Check-in Today</h5>
                    <p class="card-text">{{ employees_without_checkin_today }}</p>
                </div>
            </div>
        </div>
    </div>

    <h5>Filtered Attendance Details</h5>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Employee Name</th>
                <th>Check-In</th>
                <th>Check-Out</th>
            </tr>
        </thead>
        <tbody>
            {% for attendance in filtered_attendance_list %}
            <tr>
                <td>{{ attendance.employee.username }}</td>
                <td>
                    {% if attendance.check_in %}
                        <span class="badge bg-success">{{ attendance.check_in|date:"H:i:s" }}</span>
                    {% else %}
                        <span class="badge bg-warning">Not Checked In</span>
                    {% endif %}
                </td>
                <td>
                    {% if attendance.check_out %}
                        <span class="badge bg-primary">{{ attendance.check_out|date:"H:i:s" }}</span>
                    {% else %}
                        <span class="badge bg-danger">Not Checked Out</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="3" class="text-center">No records found for the selected filters.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
